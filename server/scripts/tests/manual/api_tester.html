<!DOCTYPE html>
<html>
<head>
  <title>ERP API Test</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.5; }
    .container { max-width: 900px; margin: 0 auto; }
    .panel { border: 1px solid #ddd; border-radius: 5px; padding: 15px; margin-bottom: 20px; }
    h2 { margin-top: 0; }
    button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; margin-bottom: 10px; }
    button:hover { background-color: #45a049; }
    input, textarea { width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box; }
    pre { background-color: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
    .error { color: red; }
    .success { color: green; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ERP API Testing Tool</h1>
    <div class="panel">
      <h2>API Configuration</h2>
      <label for="apiBaseUrl">API Base URL:</label>
      <input type="text" id="apiBaseUrl" value="http://localhost:5000/api" />
    </div>
    <div class="panel">
      <h2>1. Test Connection</h2>
      <button onclick="testConnection()">Test API Connection</button>
      <pre id="connectionResult">Results will appear here...</pre>
    </div>
    <div class="panel">
      <h2>2. Authentication</h2>
      <label for="loginEmail">Email:</label>
      <input type="email" id="loginEmail" value="admin@example.com" />
      <label for="loginPassword">Password:</label>
      <input type="password" id="loginPassword" value="admin123" />
      <button onclick="login()">Test Login</button>
      <button onclick="testAuthEndpoint()">Test Auth Endpoint</button>
      <pre id="authResult">Results will appear here...</pre>
    </div>
    <div class="panel">
      <h2>3. Custom API Request</h2>
      <label for="customEndpoint">Endpoint (without base URL):</label>
      <input type="text" id="customEndpoint" value="/auth/login" />
      <label for="customMethod">Method:</label>
      <select id="customMethod"><option>GET</option><option selected>POST</option><option>PUT</option><option>DELETE</option></select>
      <label for="customBody">Request Body (JSON):</label>
      <textarea id="customBody" rows="5">{"email": "admin@example.com", "password": "admin123"}</textarea>
      <button onclick="makeCustomRequest()">Send Request</button>
      <pre id="customResult">Results will appear here...</pre>
    </div>
  </div>
  <script>
    function displayResult(id, data, isError=false){const el=document.getElementById(id);el.className=isError?'error':'success';el.textContent=typeof data==='object'?JSON.stringify(data,null,2):data}
    function getBaseUrl(){return document.getElementById('apiBaseUrl').value.trim()}
    async function testConnection(){try{const r=await fetch(`${getBaseUrl()}/test`);const d=await r.json();displayResult('connectionResult',{status:r.status,statusText:r.statusText,data:d})}catch(e){displayResult('connectionResult',{error:e.message,tip:'Ensure server is running and URL is correct'},true)}}
    async function login(){try{const base=getBaseUrl();const email=document.getElementById('loginEmail').value;const password=document.getElementById('loginPassword').value;const r=await fetch(`${base}/auth/login`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});const d=await r.json();if(!r.ok)throw new Error(d.message||'Login failed');if(d.token)localStorage.setItem('erpToken',d.token);displayResult('authResult',{status:r.status,message:'Login successful',data:d})}catch(e){displayResult('authResult',{error:e.message,tip:'Check credentials and endpoint'},true)}}
    async function testAuthEndpoint(){const base=getBaseUrl();const email=document.getElementById('loginEmail').value;const password=document.getElementById('loginPassword').value;try{let url=`${base}/auth/login`;let r=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});if(r.ok){const d=await r.json();displayResult('authResult',{endpoint:url,status:r.status,message:'Auth endpoint working',data:d});return}url=url.replace('/api/auth','/auth');r=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});if(r.ok){const d=await r.json();displayResult('authResult',{endpoint:url,status:r.status,warning:'Working with incorrect URL pattern',tip:'Server expects /api/auth/login',data:d});return}displayResult('authResult',{error:'Both auth endpoint patterns failed',attempts:[{url:`${base}/auth/login`,status:'Failed'},{url:url,status:'Failed'}]},true)}catch(e){displayResult('authResult',{error:e.message,tip:'Ensure server is running and auth configured'},true)}}
    async function makeCustomRequest(){try{const base=getBaseUrl();const endpoint=document.getElementById('customEndpoint').value;const method=document.getElementById('customMethod').value;const bodyText=document.getElementById('customBody').value;let body=null;if(bodyText&&method!=='GET'){try{body=JSON.parse(bodyText)}catch(e){displayResult('customResult',{error:'Invalid JSON in request body',tip:'Fix JSON format'},true);return}}const url=`${base}${endpoint.startsWith('/')?endpoint:'/'+endpoint}`;const options={method,headers:{'Content-Type':'application/json'}};if(body&&method!=='GET')options.body=JSON.stringify(body);const token=localStorage.getItem('erpToken');if(token)options.headers['Authorization']=`Bearer ${token}`;const r=await fetch(url,options);let data;try{data=await r.json()}catch(e){data={text:await r.text()}}displayResult('customResult',{url,method,status:r.status,statusText:r.statusText,headers:{'content-type':r.headers.get('content-type')},data})}catch(e){displayResult('customResult',{error:e.message,tip:'Check params and ensure server is running'},true)}}
  </script>
</body>
</html>
